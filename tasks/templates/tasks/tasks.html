{% extends 'Sustain/base.html' %}


{% block content %}
    <title>Tasks</title>

    <div class="container-fluid">
        Current points: {{ profile.points }}
        <br>
        Current Tasks To Complete:
        <table style="width:50%" class="table table-striped table-bordered table-hover table-sm">
            <tr><th>Task Name</th><th>Task Description</th><th>Complete Task</th><th>Remove Task</th></tr>
            {% for task in currentTasks %}
                <tr>
                    <td>{{task.name}}</td>
                    <td>{{task.description}}</td>
                    <td>
                        <button type="submit" class="btn btn-primary" data-toggle="modal" data-target="#completeTaskModal" data-taskid="{{ task.id }}" data-taskname="{{ task.name }}">Complete Task</button>
                    </td>
                    <td>
                        <form method="POST" action="{% url 'remove_task' %}" style="display:inline">
                            {% csrf_token %}
                            <input type="hidden" name="id" value="{{ task.id }}">
                            <button type="submit" class="btn btn-danger">Remove Task</button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>
    <div class="container-fluid">
        Next Tasks To Complete:
        <table style="width:50%" class="table table-striped table-bordered table-hover table-sm">
            <tr><th>Task Name</th><th>Task Description</th><th>Add to Current Tasks</th></tr>
            {% for task in availableTasks %}
                <tr>
                    <td>{{task.name}}</td>
                    <td>{{task.description}}</td>
                    <td>
                        <form method="POST" action="{% url 'add_task' %}" style="display:inline">
                            {% csrf_token %}
                            <input type="hidden" name="id" value="{{ task.id }}">
                            <button type="submit" class="btn btn-primary">Add Task</button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>

    <div class="modal fade" id="completeTaskModal" tabindex="-1" role="dialog" aria-labelledby="completeTaskModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Complete Tasks</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <form method="POST" action="{% url 'complete_task' %}" style="display:inline">
                {% csrf_token %}
                
                <div class="modal-body">
                    <p>What is a gree energy source? name: {{this.task.name}}</p>
                    <p>A. coal, B, Nueclear, C Water</p>
                    <input type="text" name="answer" required>
                    <input type="hidden" name="id">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </div>
            </form>
          </div>
        </div>
      </div>

    <script>
        $('#completeTaskModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget);
            var taskID = button.data('taskid');
            $('input[name="id"]').val(taskID);
        });
    </script>
{% endblock %}